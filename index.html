<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Super Sena Skin Studio</title>
  <style>
    body{margin:0;display:flex;height:100vh;overflow:hidden;background:#111;color:#fff;font-family:sans-serif}
    .sidebar{width:240px;background:#1c1c1c;padding:12px;display:flex;flex-direction:column;gap:10px;overflow:auto}
    .editor{flex:1;display:flex;justify-content:center;align-items:center;background:#000;}
    canvas{background:#222;max-width:100%;max-height:100%;}
    button{padding:8px;border:none;border-radius:6px;background:#333;color:#fff;cursor:pointer;margin-bottom:6px}
    button:hover{background:#444}
  </style>
</head>
<body>
  <div class="sidebar">
    <button id="add-image">+ Adicionar Imagem</button>
    <button id="save-project">Salvar Projeto</button>
    <button id="load-project">Carregar Projeto</button>
    <button id="reset-project">Resetar</button>
    <button id="export-with-template">Exportar com Template</button>
    <button id="export-no-template">Exportar sem Template</button>
  </div>
  <div class="editor">
    <canvas id="editor-canvas" width="900" height="600"></canvas>
  </div>

  <script>
    class Renderer {
      constructor(canvas){
        this.canvas = canvas;
        this.ctx = canvas.getContext("2d");
        this.layers = [];
      }
      render(){
        this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);
        for(let layer of this.layers){
          if(layer.type === "image"){
            this.ctx.globalAlpha = layer.opacity;
            this.ctx.drawImage(layer.img, layer.x, layer.y, layer.w, layer.h);
            this.ctx.globalAlpha = 1;
          }
        }
      }
    }

    class LayersManager {
      constructor(renderer){
        this.renderer = renderer;
        this.layers = renderer.layers;
        this.selected = null;
      }
      addLayer(img){
        const layer = {type:"image", img, x:50, y:50, w:img.width/2, h:img.height/2, opacity:1};
        this.layers.push(layer);
        this.selected = layer;
      }
      removeSelected(){
        if(!this.selected) return;
        const idx = this.layers.indexOf(this.selected);
        if(idx>=0){
          this.layers.splice(idx,1);
          this.selected = null;
          this.renderer.render();
        }
      }
    }

    class ProjectManager {
      constructor(layersManager, renderer){
        this.layersManager = layersManager;
        this.renderer = renderer;
      }
      save(){
        const data = JSON.stringify(this.renderer.layers);
        localStorage.setItem("skin-project", data);
        alert("Projeto salvo!");
      }
      load(){
        const data = localStorage.getItem("skin-project");
        if(!data) return alert("Nenhum projeto salvo.");
        const parsed = JSON.parse(data);
        this.renderer.layers.length = 0;
        parsed.forEach(l => {
          const img = new Image();
          img.onload = ()=>{
            this.renderer.layers.push({...l, img});
            this.renderer.render();
          };
          img.src = l.img.src || l.img;
        });
      }
      reset(){
        this.renderer.layers.length = 0;
        this.renderer.render();
      }
    }

    class ExportManager {
      constructor(renderer,layersManager){
        this.renderer = renderer;
        this.layersManager = layersManager;
      }
      export(includeTemplate){
        const link = document.createElement("a");
        link.download = includeTemplate?"skin_with_template.png":"skin.png";
        link.href = this.renderer.canvas.toDataURL("image/png");
        link.click();
      }
    }

    window.addEventListener("DOMContentLoaded", () => {
      const editorCanvas = document.getElementById("editor-canvas");
      const renderer = new Renderer(editorCanvas);
      const layersManager = new LayersManager(renderer);
      const projectManager = new ProjectManager(layersManager, renderer);
      const exportManager = new ExportManager(renderer, layersManager);

      document.getElementById("add-image").addEventListener("click", () => {
        const input = document.createElement("input");
        input.type = "file";
        input.accept = "image/*";
        input.onchange = e => {
          const file = e.target.files[0];
          if (!file) return;
          const reader = new FileReader();
          reader.onload = () => {
            const img = new Image();
            img.onload = () => {
              layersManager.addLayer(img);
              renderer.render();
            };
            img.src = reader.result;
          };
          reader.readAsDataURL(file);
        };
        input.click();
      });

      document.getElementById("save-project").addEventListener("click", () => projectManager.save());
      document.getElementById("load-project").addEventListener("click", () => projectManager.load());
      document.getElementById("reset-project").addEventListener("click", () => projectManager.reset());
      document.getElementById("export-with-template").addEventListener("click", () => exportManager.export(true));
      document.getElementById("export-no-template").addEventListener("click", () => exportManager.export(false));

      document.addEventListener("keydown", (e) => {
        if (e.key === "Delete") layersManager.removeSelected();
        if (e.ctrlKey && e.key === "s") {
          e.preventDefault();
          projectManager.save();
        }
      });
    });
  </script>
</body>
</html>
