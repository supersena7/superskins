<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Super Sena — Skin Studio (4096x4096) + Support</title>
<meta name="description" content="Editor online de skins 4096x4096 para ETS2 — export sem template, salvar projeto, texto, camadas e export em PNG." />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#ffffff; --card:#f4f4f4; --accent:#f0b429; --muted:#555; --glass:rgba(255,255,255,0.03);
  font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}
*{box-sizing:border-box}
body{margin:0;background:#f0f0f0;color:#222}
.wrap{max-width:1400px;margin:18px auto;padding:18px}
header{display:flex;gap:12px;align-items:center}
.logo{width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#ffdf87);display:flex;align-items:center;justify-content:center;font-weight:800;color:#071018;font-size:22px}
h1{font-size:22px;margin:0}
p.lead{color:var(--muted);margin:4px 0 0}
.main{display:grid;grid-template-columns:1fr 380px;gap:16px;margin-top:16px}
.card{background:var(--card);padding:14px;border-radius:12px;border:1px solid rgba(0,0,0,0.05)}
.editor{height:720px;border-radius:12px;overflow:hidden;position:relative;background:#fff}
#viewWrap{width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:#fff;position:relative}
canvas#view{max-width:100%;max-height:100%;background:#fff;border:1px solid #ccc;border-radius:6px}
.controls{display:flex;flex-direction:column;gap:10px}
input[type="range"]{width:100%}
label{font-size:13px;color:var(--muted)}
.btn{background:var(--accent);color:#071018;padding:10px 12px;border-radius:10px;font-weight:700;border:none;cursor:pointer}
.btn.ghost{background:transparent;border:1px solid rgba(0,0,0,0.1);color:var(--muted)}
.small{font-size:13px;color:var(--muted)}
.row{display:flex;gap:8px;align-items:center}
.rightPanel{display:flex;flex-direction:column;gap:10px}
ul.layers{list-style:none;padding:0;margin:0;max-height:220px;overflow:auto}
ul.layers li{padding:8px;border-radius:8px;background:rgba(0,0,0,0.03);display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:24px;background:rgba(0,0,0,0.75);padding:10px 14px;border-radius:8px;color:#fff;display:none;z-index:9999}
footer{margin-top:16px;color:var(--muted);font-size:13px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px}
@media (max-width:980px){.main{grid-template-columns:1fr}.editor{height:520px}}
</style>
</head>
<body>
<div class="wrap">
<header>
  <div class="logo">SS</div>
  <div>
    <h1>Super Sena — Skin Studio Pro (Protótipo)</h1>
    <p class="lead">Editor 4096×4096 — exporte sem template, camadas, texto, filtros, salvar projeto.</p>
  </div>
</header>

<div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
  <a class="btn" href="#studio">Ir para o Studio</a>
  <a class="btn ghost" href="https://discord.gg/8SzFU4BnnB" target="_blank">Discord</a>
  <a class="btn ghost" href="https://instagram.com/supersena7" target="_blank">Instagram</a>
</div>

<section id="studio" class="main" style="margin-top:12px">
<div class="card">
<h2>Skin Studio — Editor 4096×4096</h2>
<div style="display:flex;gap:10px;margin-top:10px;flex-wrap:wrap">
<div style="flex:1;min-width:240px" class="controls">
  <label>Upload template (guia) — PNG/JPG 4096×4096</label>
  <input id="templateFile" type="file" accept="image/*" />
  <label>Upload imagem/logo (sticker)</label>
  <input id="imageFile" type="file" accept="image/*" />
  <div class="row">
    <label>Adicionar texto</label>
    <input id="textInput" placeholder="Texto da skin" style="flex:1;padding:6px;border-radius:6px;border:1px solid rgba(0,0,0,0.1);background:transparent;color:inherit"/>
    <button id="addTextBtn" class="btn ghost">Adicionar</button>
  </div>

  <div style="margin-top:6px">
    <label>Fonte</label>
    <select id="fontSelect" style="width:100%;padding:6px;border-radius:6px;background:transparent;border:1px solid rgba(0,0,0,0.1);color:inherit">
      <option value="Inter">Inter</option>
      <option value="Arial">Arial</option>
      <option value="Georgia">Georgia</option>
      <option value="Impact">Impact</option>
    </select>
  </div>

  <div>
    <label>Texto - Tamanho</label>
    <input id="textSize" type="range" min="12" max="400" value="72">
  </div>
  <div>
    <label>Cor do texto</label>
    <input id="textColor" type="color" value="#000000">
  </div>

  <div style="margin-top:10px">
    <label>Opções de export</label>
    <div style="display:flex;gap:8px;margin-top:8px">
      <button id="exportClean" class="btn">Exportar Skin (Sem Template)</button>
      <button id="exportWith" class="btn ghost">Exportar Skin (Com Template)</button>
    </div>
    <div style="margin-top:8px;display:flex;gap:8px">
      <button id="saveProj" class="btn">Salvar Projeto</button>
      <button id="loadProj" class="btn ghost">Carregar Projeto</button>
      <button id="resetProj" class="btn ghost">Resetar</button>
    </div>
  </div>
</div>

<div class="editor" style="flex:2;min-width:420px">
<div id="viewWrap">
<canvas id="view"></canvas>
</div>
</div>
</div>

<div style="margin-top:10px" class="small">Dica: Edite com o template visível, depois exporte sem template para gerar apenas a sua artwork (fundo transparente). Exporte com template para conferir o alinhamento.</div>
</div>

<aside class="card rightPanel">
<div>
  <div style="display:flex;justify-content:space-between;align-items:center">
    <div><strong>Status</strong></div>
    <div id="metaInfo" class="small">Pronto</div>
  </div>
</div>

<div style="margin-top:8px">
  <div class="small">Camadas (arraste no canvas para posicionar)</div>
  <ul class="layers" id="layersList"></ul>
  <div style="display:flex;gap:8px;margin-top:8px">
    <button id="bringFront" class="btn ghost">Trazer Frente</button>
    <button id="sendBack" class="btn ghost">Mandar Fundo</button>
  </div>
</div>

<div style="margin-top:8px">
  <div class="small">Controles rápidos</div>
  <div class="small" style="margin-top:6px;color:var(--muted)">
    - Clique e arraste para mover imagem/texto.<br/>
    - Use sliders de rotação e escala abaixo (aparecem ao selecionar uma camada).<br/>
    - Teclas: E = exportar (limpo), C = centralizar layer selecionada.
  </div>
</div>

<div id="layerControls" style="display:none;margin-top:8px">
  <div class="small">Controle da camada selecionada</div>
  <label>Escala</label>
  <input id="layerScale" type="range" min="0.05" max="3" step="0.01" value="1">
  <label>Rotação (°)</label>
  <input id="layerRot" type="range" min="-180" max="180" step="1" value="0">
  <label>Opacidade</label>
  <input id="layerOpacity" type="range" min="0" max="1" step="0.01" value="1">
  <div style="display:flex;gap:8px;margin-top:6px">
    <button id="delLayer" class="btn ghost">Remover</button>
    <button id="centerLayer" class="btn ghost">Centralizar</button>
  </div>
</div>

<div style="margin-top:10px">
  <div class="small">Links úteis</div>
  <div style="margin-top:6px;display:flex;flex-direction:column;gap:6px">
    <a href="https://modding.scssoft.com/wiki/Documentation/Tools/Game_Archive_Packer" target="_blank" class="small">Game Archive Packer</a>
    <a href="https://www.mods.studio/download" target="_blank" class="small">Mod Studio 2</a>
    <a href="https://livepix.gg/eullersena" target="_blank" class="small">Apoiar no Livepix</a>
  </div>
</div>

</aside>
</section>

<footer>
<div>© Super Sena — Skin Studio Prototype</div>
<div>
  <a href="https://instagram.com/supersena7" style="color:var(--muted);margin-right:10px">Instagram</a>
  <a href="https://discord.gg/8SzFU4BnnB" style="color:var(--muted)">Discord</a>
</div>
</footer>
</div>

<div class="toast" id="toast">Exportando...</div>

<script>
// Editor otimizado para performance com canvas offscreen
const view = document.getElementById('view');
const ctx = view.getContext('2d', { alpha:true });
const exportSize = 4096;
const off = document.createElement('canvas'); off.width = exportSize; off.height = exportSize;
const offCtx = off.getContext('2d', { alpha:true });

let templateImg = null;
let layers = []; 
let selectedId = null;
let dragging = false;
let dragOffset = {x:0,y:0};
let zoom=1, panX=0, panY=0;

function uid(){ return Date.now().toString(36)+Math.random().toString(36).slice(2,8);}
function showToast(msg){ const t=document.getElementById('toast'); t.innerText=msg; t.style.display='block'; setTimeout(()=>t.style.display='none',2200); }

function fitCanvas(){
  const wrap=document.getElementById('viewWrap');
  view.width=wrap.clientWidth;
  view.height=wrap.clientHeight;
  draw();
}
window.addEventListener('resize', fitCanvas);

function viewToExport(clientX, clientY){
  const rect = view.getBoundingClientRect();
  const vx = clientX - rect.left;
  const vy = clientY - rect.top;
  return {x:(vx - panX)/zoom, y:(vy - panY)/zoom};
}

function composeToOff(includeTemplate=true){
  offCtx.clearRect(0,0,exportSize,exportSize);
  offCtx.fillStyle = "#fff";
  offCtx.fillRect(0,0,exportSize,exportSize);
  if(includeTemplate && templateImg){
    offCtx.drawImage(templateImg, 0, 0, exportSize, exportSize);
  }
  for(const layer of layers){
    offCtx.save();
    offCtx.globalAlpha = layer.opacity ?? 1;
    offCtx.translate(layer.x, layer.y);
    offCtx.rotate(layer.rot || 0);
    if(layer.type==='image'){
      const w = layer.img.width*(layer.scale||1);
      const h = layer.img.height*(layer.scale||1);
      offCtx.drawImage(layer.img, -w/2, -h/2, w, h);
    } else if(layer.type==='text'){
      offCtx.font=`${layer.size||72}px ${layer.font||'Inter'}`;
      offCtx.fillStyle=layer.color||'#000';
      offCtx.textAlign='center';
      offCtx.textBaseline='middle';
      offCtx.scale(layer.scale||1, layer.scale||1);
      offCtx.fillText(layer.text, 0,0);
    }
    offCtx.restore();
  }
}

function draw(){
  ctx.clearRect(0,0,view.width,view.height);
  ctx.save();
  ctx.translate(panX, panY);
  ctx.scale(zoom, zoom);
  composeToOff(true);
  ctx.drawImage(off, 0,0, exportSize, exportSize);
  if(selectedId){
    const s=layers.find(l=>l.id===selectedId);
    if(s){
      ctx.strokeStyle='rgba(240,180,41,0.9)';
      ctx.lineWidth=2;
      ctx.setLineDash([8,6]);
      ctx.save();
      ctx.translate(s.x, s.y);
      ctx.rotate(s.rot||0);
      if(s.type==='image'){
        const w = s.img.width*(s.scale||1);
        const h = s.img.height*(s.scale||1);
        ctx.strokeRect(-w/2,-h/2,w,h);
      } else {
        const boxW=(s.text.length*(s.size||72)*0.5)*(s.scale||1);
        const boxH=(s.size||72)*(s.scale||1);
        ctx.strokeRect(-boxW/2,-boxH/2,boxW,boxH);
      }
      ctx.restore();
    }
  }
  ctx.restore();
}

// template
document.getElementById('templateFile').addEventListener('change', e=>{
  const f=e.target.files[0]; if(!f) return;
  const url=URL.createObjectURL(f);
  const i=new Image();
  i.onload=()=>{ templateImg=i; draw(); document.getElementById('metaInfo').innerText='Template carregado'; }
  i.src=url;
});

// image/logo
document.getElementById('imageFile').addEventListener('change', e=>{
  const f=e.target.files[0]; if(!f) return;
  const url=URL.createObjectURL(f);
  const i=new Image();
  i.onload=()=>{
    const id=uid();
    const scale=Math.min(1,(exportSize*0.25)/Math.max(i.width,i.height));
    layers.push({id,type:'image',img:i,x:exportSize/2,y:exportSize/2,scale,rot:0,opacity:1});
    rebuildLayersList(); draw();
  }
  i.src=url;
});

// add text
document.getElementById('addTextBtn').addEventListener('click', ()=>{
  const txt=document.getElementById('textInput').value.trim();
  if(!txt) return alert('Digite um texto');
  const id=uid();
  const size=parseInt(document.getElementById('textSize').value,10)||72;
  const font=document.getElementById('fontSelect').value;
  const color=document.getElementById('textColor').value;
  layers.push({id,type:'text',text:txt,x:exportSize/2,y:exportSize/2,scale:1,rot:0,opacity:1,font,size,color});
  rebuildLayersList(); draw(); document.getElementById('textInput').value='';
});

// layers list & select
function rebuildLayersList(){
  const ul=document.getElementById('layersList'); ul.innerHTML='';
  layers.forEach((l,idx)=>{
    const li=document.createElement('li');
    const title=l.type==='image'?`Image ${idx+1}`:(l.text||'Text');
    li.innerHTML=`<div style="display:flex;gap:8px;align-items:center"><div style="width:36px;height:24px;border-radius:4px;background:rgba(0,0,0,0.05);display:flex;align-items:center;justify-content:center;font-size:12px">${l.type==='image'?'IMG':'T'}</div><div style="min-width:120px">${title}</div></div><div style="display:flex;gap:6px"><button data-id="${l.id}" class="btn ghost small">Sel</button></div>`;
    ul.appendChild(li);
    li.querySelector('button').addEventListener('click', ()=>{ selectLayer(l.id); });
  });
}

function selectLayer(id){
  selectedId=id;
  document.getElementById('layerControls').style.display=id?'block':'none';
  updateLayerControls();
  draw();
}

function updateLayerControls(){
  const l=layers.find(x=>x.id===selectedId); if(!l) return;
  document.getElementById('layerScale').value=l.scale||1;
  document.getElementById('layerRot').value=(l.rot||0)*180/Math.PI;
  document.getElementById('layerOpacity').value=l
